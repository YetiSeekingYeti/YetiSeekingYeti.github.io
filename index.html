<html>
<head>
<script>

var mainCanvas;
var cCon;

var mouseDown = false;

var mouseX;
var mouseY;
var canvLeft;
var canvTop;

var mouseHoldTimer;

var weightsArray;

function onLoadFunction(){
	mainCanvas = document.getElementById("canvas_main");
	cCon = mainCanvas.getContext("2d");
	
	var canvasImage = new Image();
	canvasImage.src = "./images/discworld_1.jpg";
	canvasImage.onload = function() {
		cCon.drawImage(canvasImage, 0, 0);
	}
	
	canvLeft = mainCanvas.getBoundingClientRect().left;
	canvTop = mainCanvas.getBoundingClientRect().top;
	
	//column 0 array holding row arrays
	weightsArray = new Array(mainCanvas.height);
	for(i = 0; i < weightsArray.length; i++){
		weightsArray[i] = new Array(mainCanvas.width);
		for(j = 0; j < weightsArray[i].length; j++){
			weightsArray[i][j] = 0;
		}
	}
	document.getElementById("array_p").innerHTML = parseInt(weightsArray.length) + " by " + parseInt(weightsArray[0].length);
	
	document.onmousemove = mouseMoveFunction;
	document.onmousedown = mouseDownFunction;
	document.onmouseup = mouseUpFunction;
	document.onmouseleave = mouseUpFunction;
}


function mouseDownFunction(e){
	mouseDown = true;
	mouseHoldTimer = setInterval(mouseHoldFunction, 10);
	document.getElementById("interval_p").innerHTML = "set";
}

function mouseUpFunction(e){
	mouseDown = false;
	if(mouseHoldTimer){
		clearInterval(mouseHoldTimer);
		document.getElementById("interval_p").innerHTML = "clear";
	}
}

function mouseMoveFunction(e){
	
	mouseX = e.pageX-canvLeft;
	mouseY = e.pageY-canvTop;
	
	document.getElementById("debug_p").innerHTML = mouseX + ":" + mouseY;
	
}

function mouseHoldFunction(e) {
	updatePixel(mouseX, mouseY);
}

function updatePixel(x, y){
	//update the weights array
	if(x >= 1 && x < 399 && y >= 0 && y < 400){
		document.getElementById("inAr_p").innerHTML = x + "---" + y;
		
		if(weightsArray[x][y] == 0){
			weightsArray[x][y] = 2;
		}
		else if(weightsArray[x][y] > 255){
			weightsArray[x][y] = 255;
		}
		else{
			
			weightsArray[x][y] += 2;
		}
		
		//use fill rect to update the corresponding pixel
		if(weightsArray[x][y] > 0){
			
			var col = (256-weightsArray[x][y]).toString(16);
			if(col.length < 2){
				col = "0" + col;
			}
		
			cCon.fillStyle = "#" + col + col + col;
		
			document.getElementById("adj_test_p").innerHTML = cCon.fillStyle;
			cCon.fillRect(x, y, 1, 1);
			
			//check surrounding pixels
			if(weightsArray[x-1][y] + 3 < weightsArray[x][y]){
				updatePixel(x-1, y);
			}
			if(weightsArray[x+1][y] + 3 < weightsArray[x][y]){
				updatePixel(x+1, y);
			}
			if(weightsArray[x][y-1] + 3 < weightsArray[x][y]){
				updatePixel(x, y-1);
			}
			if(weightsArray[x][y+1] + 3 < weightsArray[x][y]){
				updatePixel(x, y+1);
			}
		}
	}
	else{
		document.getElementById("inAr_p").innerHTML = "nope";
	}
	
}

</script>
</head>

<body onload="onLoadFunction();">

	<p id="debug_p">debug text</p>
	<p id="interval_p">debug text 2</p>
	<p id="array_p">debug text 3</p>
	<p id="inAr_p">debug text 4</p>
	<p id="adj_test_p">debug 5</p>

<!-- add the canvas with a picture in it -->
	<canvas id="canvas_main" width="400" height="400" style="border:1px solid #000000">
	</canvas>
</body>

<html>